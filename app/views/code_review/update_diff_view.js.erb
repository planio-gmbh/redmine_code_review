$('#code_review').html('<%= j render partial: 'update_diff_view' %>');

var repository_id = "<%= j @repository_id %>";
var is_readonly = <%= !authorize_for('code_review', 'new') %>;
var is_diff = <%= !!(@action_type == 'diff' or (@attachment and @attachment.is_diff?)) %>;
var action_type = '<%= j @action_type %>';
var rev = '<%= j @rev %>';
var rev_to = '<%= j @rev_to %>';
window.path = '<%= j @path -%>';

setAddReviewButton('<%= j new_code_review_url(id: @project) %>', '<%= @change.try :id %>', '<%= j image_tag('edit.png', :alt => l(:label_add_review), :title => l(:label_add_review)) %>', is_readonly, is_diff, '<%= @attachment.try :id %>' );

window.showReviewImageTag = '<%= j image_tag('review.png', :plugin => 'redmine_code_review', :alt => l(:label_show_review), :title => l(:label_show_review)) %>';
window.showClosedReviewImageTag = '<%= j image_tag('closed_review.png', :plugin => 'redmine_code_review', :alt => l(:label_show_review), :title => l(:label_show_review)) %>';

<% for review in @reviews do %>
  setShowReviewButton('<%= j code_review_url(id: @project, review_id: review) %>', <%= review.line %>, <%= review.id %>, <%= review.is_closed? %>, <%= review.file_count %> );
<% end %>

<% if @show_review_id -%>
  popupReview(<%= @show_review_id.to_i %>, '<%= j code_review_url(id: @project, review_id: @show_review_id) %>');
<% end -%>
$('#content table.filecontent:first').before($('#code-review-assign-link'));
