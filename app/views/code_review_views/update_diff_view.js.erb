$('#code_review').html('<%= j render partial: 'update_diff_view' %>');

var is_readonly = <%= !authorize_for('code_reviews', 'new') %>;
var is_diff = <%= !!(@action_type == 'diff' or (@attachment and @attachment.is_diff?)) %>;
window.path = '<%= j @path -%>';

<% if @attachment %>
  var addReviewUrl = '<%= j new_code_review_url id: @project, action_type: 'attachment', attachment_id: @attachment.id %>';
<% else %>
  // TODO rev und repo koennen im prinzip raus wegen changeset
  var addReviewUrl = '<%= j new_code_review_url id: @project, action_type: @action_type, change_id: @change.try(:id), rev: @rev, rev_to: @rev_to, repository_id: @repository.id, changeset_id: @changeset.id, path: @path %>';
<% end %>

setAddReviewButton(addReviewUrl, '<%= j image_tag('edit.png', :alt => l(:label_add_review), :title => l(:label_add_review)) %>', is_readonly, is_diff);

window.showReviewImageTag = '<%= j image_tag('review.png', :plugin => 'redmine_code_review', :alt => l(:label_show_review), :title => l(:label_show_review)) %>';
window.showClosedReviewImageTag = '<%= j image_tag('closed_review.png', :plugin => 'redmine_code_review', :alt => l(:label_show_review), :title => l(:label_show_review)) %>';

<% for review in @reviews do %>
  setShowReviewButton('<%= j code_review_url(id: @project, review_id: review) %>', <%= review.line %>, '<%= review.id %>', <%= review.is_closed? %>, <%= review.file_count %> );
<% end %>

<% if @show_review -%>
  popupReview('<%= @show_review.id %>', '<%= j code_review_url(id: @project, review_id: @show_review.id) %>');
<% end -%>
$('#content table.filecontent:first').before($('#code-review-assign-link'));
